#!/usr/bin/env bash
# Purpose: Meta information CLI about AI tools for agents to use.
set -euo pipefail

SCRIPT_NAME="$(basename "$0")"
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
COMMANDS_DIR="${SCRIPT_DIR}/aimeta.d"

usage() {
  echo "${SCRIPT_NAME} - Meta information about AI tools for agents"
  echo ""
  echo "USAGE: ${SCRIPT_NAME} <command> [options]"
  echo ""
  echo "COMMANDS:"
  # Auto-discover commands from aimeta.d/
  if [[ -d "$COMMANDS_DIR" ]]; then
    for cmd_file in "$COMMANDS_DIR"/*; do
      [[ -x "$cmd_file" && -f "$cmd_file" ]] || continue
      local cmd_name desc
      cmd_name="$(basename "$cmd_file")"
      desc=$(grep -m1 '^### DESCRIPTION:' "$cmd_file" 2>/dev/null | sed 's/^### DESCRIPTION:[[:space:]]*//' || echo "(no description)")
      printf "  %-12s %s\n" "$cmd_name" "$desc"
    done
  fi
  printf "  %-12s %s\n" "help" "Show this help message"
  echo ""
  echo "EXAMPLES: ${SCRIPT_NAME} subagents"
}

main() {
  local cmd="${1:-}"
  case "$cmd" in
    help|--help|-h)
      usage; exit 0 ;;
    "")
      echo "Error: No command specified" >&2; usage >&2; exit 1 ;;
    *)
      if [[ -x "${COMMANDS_DIR}/${cmd}" ]]; then
        shift; exec "${COMMANDS_DIR}/${cmd}" "$@"
      else
        echo "Error: Unknown command '$cmd'" >&2; usage >&2; exit 1
      fi ;;
  esac
}

main "$@"
